<!DOCTYPE HTML>
<html>
<head>
	<title>#{title}</title>
	<script src="/javascripts/jquery-1.11.2.js" type="application/javascript">
</script>

<script type="application/javascript">
<!--

function loadList() {
	$.ajax({
	 
		// The URL for the request
		url: "http://pi:5984/alice/_design/list_contacts/_view/list_contacts",
	  
		// Whether this is a POST or GET request
		type: "GET",
	 
		// The type of data we expect back
		dataType : "jsonp",
	 
		// Code to run if the request succeeds;
		// the response is passed to the function
		success: function( data ) {
		
			$( "<h2>" ).text( data.total_rows ).appendTo( "body" );     
	
			var output="<ul>";
			for (var i in data.rows) {
			
	 			var id = data.rows[i].id;
	 			var key = data.rows[i].key;
	 			var name = data.rows[i].value;
	// 			output+="<li>" + data.rows[i].id+ ": " +key+ " : " + name+ "<\/li>";
	
	//			output+='<li><a href="#" onclick="loadContact(\'{%=' + data.rows[i].id+ "%}');\">Open File<\/a>: " +data.rows[i].key+ " : " +data.rows[i].value+ "<\/li>";

				output+='<li><a href="#" onclick="loadContact(\''+id +'\');">Open File<\/a>: "' +key+ " : " +name+ "<\/li>";
	
			}
	
			output+="<\/ul>";
			document.getElementById("placeholder").innerHTML=output;
			i++;
			console.log( "Status: " + i + " rows returned");
	
		},
	 
		// Code to run if the request fails; the raw request and
		// status codes are passed to the function
		error: function( xhr, status, errorThrown ) {
			alert( "Sorry, there was a problem!" );
			console.log( "Error: " + errorThrown );
			console.log( "Status: " + status );
			console.dir( xhr );
		},
	 
		// Code to run regardless of success or failure
		complete: function( xhr, status ) {
			//alert( "The request is complete!" );
		}
	});
}

function loadContact(thisFile) {

	$.ajax({
	 
		// The URL for the request
		url: "http://pi:5984/alice/" +thisFile,
	  
		// Whether this is a POST or GET request
		type: "GET",
	 
		// The type of data we expect back
		dataType : "jsonp",
	 
		// Code to run if the request succeeds;
		// the response is passed to the function
		success: function( data ) {

			output= data.name;
		
			output+="<\/ul>";
			document.getElementById("placeholder").innerHTML=output;
			//console.log( "Status: " +url);
	
		},
	 
		// Code to run if the request fails; the raw request and
		// status codes are passed to the function
		error: function( xhr, status, errorThrown ) {
			alert( "Sorry, there was a problem!" );
			console.log( "Error: " + errorThrown );
			console.log( "Status: " + status );
			console.dir( xhr );
		},
	 
		// Code to run regardless of success or failure
		complete: function( xhr, status ) {
			alert( "The request is complete!" );
		}
	});

}

//-->
</script>

</head>
<body onload="loadList()">

<div>Your Results: </div>

<div id="placeholder">

</div>

</body>
</html>

